version: '3.0'
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
intents:
# base intents
- intent_greet
- intent_explain_ipm
- intent_deny
- intent_goodbye
- intent_affirm
- intent_bot_challenge
# Main intents
- intent_request_expert
- intent_help_image
# Decision Tree intents
# - request_plant_problem
# ES intents
- intent_help_pest
- intent_help_question
entities:
- plant_damage
- plant_name
- plant_part
- plant_type
slots:
  shown_greeting:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  shown_privacy_policy:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  shown_explain_ipm:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  # Decision Tree slots
  # plant_type:
  #   type: text
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_type
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_type
  # plant_name:
  #   type: text
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_name
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_name
  # plant_part:
  #   type: text
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_part
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_part
  # plant_damages:
  #   type: list
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_damage
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_damages
# Knowledge Base Query slots
  question:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
        - active_loop: es_query_form
          requested_slot: question
  pest_problem_description:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
        - active_loop: es_query_form
          requested_slot: pest_problem_description
  pest_causes_damage:
    type: text
    influence_conversation: false
    mappings:
      - type: from_intent
        value: yes
        intent: intent_affirm
        conditions:
        - active_loop: es_query_form
          requested_slot: pest_causes_damage
      - type: from_intent
        value: no
        intent: intent_deny
        conditions:
        - active_loop: es_query_form
          requested_slot: pest_causes_damage
  pest_damage_description:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
        - active_loop: es_query_form
          requested_slot: pest_damage_description
  pests_summaries:
    type: text
    mappings:
      - type: custom
responses:
  # Basic responses
  utter_default:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    - payload: /intent_request_expert
      title: Connect me to expert.
    text: I'm sorry, I am still learning thanks to your inputs.
  utter_goodbye:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: Bye!
  utter_iamabot:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: I am a bot, powered by Rasa.    
  utter_greet:
  - text: Hi, I am AskExtension Assistant!
  utter_privacy_policy:
  - text: By chatting with me, you agree to our [privacy policy](https://ucanr.edu/?privacyStatement/).
  utter_connect_expert:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: You can ask one of our experts at [Ask Extension](https://ask2.extension.org/open.php).
  utter_explain_ipm:
  - text: >
      IPM is an ecosystem-based strategy that focuses on long-term prevention of pests or their damage through a combination of techniques such as biological control, 
      habitat manipulation, modification of cultural practices, and use of resistant varieties. Pesticides are used only after monitoring indicates they are needed 
      according to established guidelines, and treatments are made with the goal of removing only the target organism. Pest control materials are selected and applied 
      in a manner that minimizes risks to human health, beneficial and nontarget organisms, and the environment. You can find more details [here](https://www2.ipm.ucanr.edu/What-is-IPM/).
  utter_help_image:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    - payload: /intent_request_expert
      title: Connect me to expert.
    text: Not implemented. To be available soon.
  # Decision Tree responses
  # utter_submit_plant_problem_form:
  # - text: |-
  #     I am going to run a plant problem search using the following parameters:
  #      - plant_type: {plant_type}
  #      - plant_name: {plant_name}
  #      - plant_part: {plant_part}
  #      - plant_damages: {plant_damages}
  # ES questions responses
  utter_ask_question:
  - text: Please enter your question.
  utter_ask_pest_problem_description:
  - text: Please describe your pest problem.
  utter_ask_pest_causes_damage:
  - buttons:
    - payload: /intent_affirm
      title: Yes
    - payload: /intent_deny
      title: No
    text: Do you see any traces of damage?
  utter_ask_pest_damage_description:
  - text: Please describe the damage.
  utter_ask_pest_summary_and_did_this_help:
  - buttons:
    - payload: /intent_affirm
      title: üëç
    - payload: /intent_deny
      title: üëé
    text: '{pest_summary}'
actions:
- action_explain_ipm
- action_greet
# Decision Tree actions
# - action_ask_plant_type
# - action_ask_plant_name
# - action_ask_plant_part
# - action_ask_plant_damages
# - validate_plant_problem_form
# - action_submit_plant_problem_form
# Knowledge Base Query actions
- validate_es_query_form
# - action_ask_question
- action_submit_es_query_form
forms:
  # Decision Tree form
  # plant_problem_form:
  #   required_slots:
  #   - plant_type
  #   - plant_name
  #   - plant_part
  #   - plant_damages
  # ES forms
  es_query_form:
    # ignored_intents: 
    # - request_plant_problem
    # - request_plant_picture
    # - request_generic_question
    # - request_expert
    required_slots:
    - question
    - pest_problem_description
    - pest_causes_damage
    - pest_damage_description
