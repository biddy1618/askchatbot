version: '3.0'
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
intents:
# base intents
- intent_greet
- intent_explain_ipm
- intent_deny
- intent_goodbye
- intent_affirm
- intent_bot_challenge
# Decision Tree intents
# - request_plant_problem
# - request_plant_picture
# - request_generic_question
# - request_expert
# ES intents
- intent_i_have_a_pest
- intent_i_have_a_question
entities:
- plant_damage
- plant_name
- plant_part
- plant_type
slots:
  shown_greeting:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  shown_privacy_policy:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  shown_explain_ipm:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  # Decision Tree slots
  # plant_type:
  #   type: text
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_type
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_type
  # plant_name:
  #   type: text
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_name
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_name
  # plant_part:
  #   type: text
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_part
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_part
  # plant_damages:
  #   type: list
  #   influence_conversation: true
  #   mappings:
  #   - type: from_entity
  #     entity: plant_damage
  #     conditions:
  #     - active_loop: plant_problem_form
  #       requested_slot: plant_damages
# Knowledge Base Query slots
  question:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
        - active_loop: query_knowledge_base_form
          requested_slot: question
  pest_problem_description:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
        - active_loop: query_knowledge_base_form
          requested_slot: pest_problem_description
  pest_causes_damage:
    type: text
    influence_conversation: false
    mappings:
      - type: from_intent
        value: yes
        intent: intent_affirm
      - type: from_intent
        value: no
        intent: intent_deny        
  pest_damage_description:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
        - active_loop: query_knowledge_base_form
          requested_slot: pest_damage_description
  pests_summaries:
    type: text
    mappings:
      - type: custom
responses:
  utter_default:
  - text: I'm sorry, I am still learning thanks to your inputs.
  utter_did_that_help:
  - text: Did that help you?
  utter_happy:
  - text: Great, carry on!
  utter_goodbye:
  - text: Bye
  utter_iamabot:
  - text: I am a bot, powered by Rasa.
  utter_greet:
  - text: Hi, I am AskExtension Assistant!
  utter_privacy_policy:
  - text: By chatting with me, you agree to our [privacy policy](https://ucanr.edu/?privacyStatement/).
  utter_ask_connect_expert:
  - buttons:
    - payload: /intent_affirm
      title: Yes
    - payload: /intent_deny
      title: No
    text: "Sorry, I am not able to answer the question.\nDo you want to ask a human expert?"
  utter_connect_expert:
  - text: You can ask one of our experts at [ask extension](https://ask2.extension.org/open.php).
  utter_explain_ipm:
  - text: |-
      IPM is an ecosystem-based strategy that focuses on long-term prevention of pests or their damage through a combination of techniques such as biological control, habitat manipulation, modification of cultural practices, and use of resistant varieties.
      Pesticides are used only after monitoring indicates they are needed according to established guidelines, and treatments are made with the goal of removing only the target organism.
      Pest control materials are selected and applied in a manner that minimizes risks to human health, beneficial and nontarget organisms, and the environment.
      You can find more details [here](https://www2.ipm.ucanr.edu/What-is-IPM/).
  utter_select_options:
  - text: How can I help you?
    buttons:
    - payload: /request_plant_problem
      title: I have problem with my plant.
    - payload: /request_plant_picture
      title: I have a picture and I would like to get help on that.
    - payload: /request_generic
      title: I have generic request.
    - payload: /request_expert
      title: Connect me to askextension expert.
  utter_submit_plant_problem_form:
  - text: |-
      I am going to run a plant problem search using the following parameters:
       - plant_type: {plant_type}
       - plant_name: {plant_name}
       - plant_part: {plant_part}
       - plant_damages: {plant_damages}
  # ES questions
  utter_ask_question:
  - text: Please enter your question
  utter_ask_pest_problem_description:
  - text: Please describe your pest problem
  utter_ask_pest_causes_damage:
  - buttons:
    - payload: /intent_yes
      title: Yes
    - payload: /intent_no
      title: No
    text: '{cause_damage_question}'
  utter_ask_pest_damage_description:
  - text: Please describe the damage
  utter_ask_pest_summary_and_did_this_help:
  - buttons:
    - payload: /intent_yes
      title: üëç
    - payload: /intent_no
      title: üëé
    text: '{pest_summary}'
actions:
- action_explain_ipm
- action_greet
# Decision Tree actions
# - action_ask_plant_type
# - action_ask_plant_name
# - action_ask_plant_part
# - action_ask_plant_damages
# - validate_plant_problem_form
# - action_submit_plant_problem_form
# Knowledge Base Query actions
- action_kickoff_intent_i_have_a_pest
- action_kickoff_intent_i_have_a_question
- action_ask_handoff_to_expert
- action_submit_query_knowledge_base_form
# - validate_query_knowledge_base_form
forms:
  # DT form
  # plant_problem_form:
  #   required_slots:
  #   - plant_type
  #   - plant_name
  #   - plant_part
  #   - plant_damages
  # ES forms
  query_knowledge_base_form:
    # ignored_intents: 
    # - request_plant_problem
    # - request_plant_picture
    # - request_generic_question
    # - request_expert
    required_slots:
    - question
    - pest_problem_description
    - pest_causes_damage
    - pest_damage_description
