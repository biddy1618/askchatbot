version: '3.0'
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
intents:
# Debug intents
- intent_set_parameter
# Base intents
- intent_greet
- intent_affirm
- intent_deny
- intent_not_clear
- intent_goodbye
- intent_bot_challenge
- intent_out_of_score
# Main intents
- intent_explain_ipm
- intent_request_expert
# ES intents
- intent_help_question
- intent_problem_description
# Tests
- intent_test_images
- intent_test_videos
- intent_test_dropdows
- intent_test_quick_replies
- intent_test_collapsible
- intent_test_carousel
entities:
- plant_damage
- plant_name
- plant_part
- plant_type
- plant_pest
- pest_target
slots:
  # Basic slots
  shown_greeting:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  shown_explain_ipm:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  done_query:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom
  # ES query form slots
  es_data:
    type: any
    mappings:
    - type: custom
  problem_description:
    type: text
    influence_conversation: false
    mappings:
      - type: custom
        action: action_validate_problem_description
  # Additional slots
  plant_name:
    type: list
    mappings:
      - type: from_entity
        entity: plant_name
  plant_type:
    type: list
    mappings:
      - type: from_entity
        entity: plant_type
  plant_part:
    type: list
    mappings:
      - type: from_entity
        entity: plant_part
  plant_damage:
    type: list
    mappings:
      - type: from_entity
        entity: plant_damage
  plant_pest:
    type: list
    mappings:
      - type: from_entity
        entity: plant_pest
  pest_target:
    type: list
    mappings:
      - type: from_entity
        entity: pest_target
  # ES query result slots
  # query_more:
  #   type: text
  #   mappings:
  #     - type: from_intent
  #       value: yes
  #       intent: intent_affirm
  #       conditions:
  #       - active_loop: es_result_form
  #         requested_slot: query_more
  #     - type: from_intent
  #       value: no
  #       intent: intent_deny
  #       conditions:
  #       - active_loop: es_result_form
  #         requested_slot: query_more
  problem_description_add:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        intent: intent_problem_description
        conditions:
        - active_loop: es_result_form
          requested_slot: problem_description_add
      - type: from_intent
        value: yes
        intent: intent_affirm
        conditions:
        - active_loop: es_result_form
          requested_slot: problem_description_add
responses:
  # Basic responses
  utter_goodbye:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: Bye!
  utter_iamabot:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: I am a bot, powered by <a href="https://rasa.com/" target="_blank">Rasa</a> platform. I can help you with the pest-related issues and questions. If you have one, please, describe your problem :D
  utter_greet:
  - text: Hi, I'm AskExtension Assistant!
  utter_connect_expert:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: You can ask one of our experts at <a href="https://ask2.extension.org/open.php" target="_blank">Ask Extension</a>.
  utter_explain_ipm:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    text: >
      IPM (Integrated Pest Management) is an ecosystem-based strategy that focuses on long-term prevention of pests or their damage through a combination of techniques such as biological control, 
      habitat manipulation, modification of cultural practices, and use of resistant varieties. You can find more details <a href="https://www2.ipm.ucanr.edu/What-is-IPM/" target="_blank">here</a>.
  utter_out_of_scope:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    - payload: /intent_request_expert
      title: Connect me to askextension expert.
    text: Sorry, I can't handle that request. For now, I can handle pest related requests. Try me :D
  utter_default:
  - buttons:
    - payload: /intent_greet
      title: Main menu.
    - payload: /intent_request_expert
      title: Connect me to askextension expert.
    text: I'm sorry, I am still learning. Can you rephrase?
  # ES query form slots questions
  utter_ask_problem_description:
  - text: Please describe your problem.
  # ES result form slots questions
  # utter_ask_query_more:
  # - buttons:
  #   - payload: /intent_affirm
  #     title: Yes.
  #   - payload: /intent_deny
  #     title: No.
  #   text: Do you have any additional details to give you a better help?
  utter_ask_problem_description_add:
  - buttons:
    - payload: /intent_affirm
      title: Yes, it helped.
    text: Did that answer your question? If not, can you give me some more information about where you saw this?
  # Testing utterances
  utter_test_images:
  - text: "Here is something to cheer you up ðŸ˜‰ "
    image: "https://i.imgur.com/nGF1K8f.jpg"
  utter_test_videos:
  - text: "Check this video"
    attachment: { "type":"video", "payload":{ "src": "https://youtube.com/embed/9C1Km6xfdMA" } }
  utter_test_droprows:
  - text: "Please select a option"
    custom:
      payload: dropDown
      data:
      - label: option1
        value: option1
      - label: option2
        value: option2
      - label: option3
        value: option3
  utter_test_quick_replies:
  - text: "Please choose a reply"
    custom:
      payload: quickReplies
      data:
      - title: reply1
        payload: reply1
      - title: reply2
        payload: reply2
      - title: reply3
        payload: reply3
  utter_test_collapsible:
  - text: "You can check the following options"
    custom: 
      payload: "collapsible"
      data: 
      - title: Title1
        description: Sick leave is time off from work that workers can use to stay home
          to address their health and safety needs without losing pay.
      - title: Title2
        description: 'Earned Leaves are the leaves which are earned in the previous year
          and enjoyed in the preceding years. '
      - title: Title3
        description: Casual Leave are granted for certain unforeseen situation or were you
          are require to go for one or two days leaves to attend to personal matters and
          not for vacation.
      - title: Title4
        description: Flexi leave is an optional leave which one can apply directly in system
          at lease a week before.
  utter_test_carousel:
    - custom:
        payload: cardsCarousel
        data:
        - image: https://b.zmtcdn.com/data/pictures/1/17428541/da50010b1a953dfbb109306fba5a6c06.jpg
          name: abc
          ratings: '4.0'
          title: pqr
        - image: https://b.zmtcdn.com/data/pictures/1/17428541/da50010b1a953dfbb109306fba5a6c06.jpg
          name: abc
          ratings: '4.0'
          title: pqr
        - image: https://b.zmtcdn.com/data/pictures/1/17428541/da50010b1a953dfbb109306fba5a6c06.jpg
          name: abc
          ratings: '4.0'
          title: pqr
        - image: https://b.zmtcdn.com/data/pictures/1/17428541/da50010b1a953dfbb109306fba5a6c06.jpg
          name: abc
          ratings: '4.0'
          title: pqr

actions:
# Debug actions
- action_set_parameter
# Base actions
- action_explain_ipm
- action_greet
# ES query form actions
- action_validate_problem_description
- validate_es_query_form
- action_submit_es_query_form
# ES result form actions
- validate_es_result_form
- action_submit_es_result_form
forms:
  # ES forms
  es_query_form:
    required_slots:
    - problem_description
    - plant_name
    - plant_type
    - plant_part
    - plant_damage
    - plant_pest
    - pest_target
  es_result_form:
    required_slots:
    - problem_description_add
    - plant_name
    - plant_type
    - plant_part
    - plant_damage
    - plant_pest
    - pest_target